import{c as K,d as G,r as O,Q as fe,b as B,h as U,R as he,w as X,T as ne,U as we,o as le,V as q,f as u,n as L,t as z,a as N,E as ye,W as Se,X as A,K as se,g as Pe,Y as re,Z as Ie,$ as Ce,e as ce,a0 as _,a1 as F,a2 as Y,a3 as be,a4 as xe,a5 as ue,a6 as ke,a7 as ze,m as H,a8 as ae,a9 as Oe,aa as Te,ab as Re,P as Ye,M as Xe,ac as Ze,ad as Ee,ae as $e,af as Le}from"./index-DaeGBLXV.js";import{a as De,S as Be}from"./index-ClkfONVj.js";const[Me,E]=K("image"),_e={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:L,height:L,radius:L,lazyLoad:Boolean,iconSize:L,showError:z,errorIcon:N("photo-fail"),iconPrefix:String,showLoading:z,loadingIcon:N("photo"),crossorigin:String,referrerpolicy:String};var He=G({name:Me,props:_e,emits:["load","error"],setup(e,{emit:c,slots:v}){const o=O(!1),r=O(!0),l=O(),{$Lazyload:d}=fe().proxy,T=B(()=>{const t={width:U(e.width),height:U(e.height)};return he(e.radius)&&(t.overflow="hidden",t.borderRadius=U(e.radius)),t});X(()=>e.src,()=>{o.value=!1,r.value=!0});const g=t=>{r.value&&(r.value=!1,c("load",t))},C=()=>{const t=new Event("load");Object.defineProperty(t,"target",{value:l.value,enumerable:!0}),g(t)},b=t=>{o.value=!0,r.value=!1,c("error",t)},f=(t,w,I)=>I?I():u(se,{name:t,size:e.iconSize,class:w,classPrefix:e.iconPrefix},null),h=()=>{if(r.value&&e.showLoading)return u("div",{class:E("loading")},[f(e.loadingIcon,E("loading-icon"),v.loading)]);if(o.value&&e.showError)return u("div",{class:E("error")},[f(e.errorIcon,E("error-icon"),v.error)])},R=()=>{if(o.value||!e.src)return;const t={alt:e.alt,class:E("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?ye(u("img",A({ref:l},t),null),[[Se("lazy"),e.src]]):u("img",A({ref:l,src:e.src,onLoad:g,onError:b},t),null)},P=({el:t})=>{const w=()=>{t===l.value&&r.value&&C()};l.value?w():q(w)},Z=({el:t})=>{t===l.value&&!o.value&&b()};return d&&ne&&(d.$on("loaded",P),d.$on("error",Z),we(()=>{d.$off("loaded",P),d.$off("error",Z)})),le(()=>{q(()=>{var t;(t=l.value)!=null&&t.complete&&!e.lazyLoad&&C()})}),()=>{var t;return u("div",{class:E({round:e.round,block:e.block}),style:T.value},[R(),h(),(t=v.default)==null?void 0:t.call(v)])}}});const We=Pe(He),te=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Ne=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),V=K("image-preview")[1],ie=2.6,Ae={src:String,show:Boolean,active:Number,minZoom:_(L),maxZoom:_(L),rootWidth:_(Number),rootHeight:_(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var je=G({props:Ae,emits:["scale","close","longPress"],setup(e,{emit:c,slots:v}){const o=re({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=Ie(),l=O(),d=O(),T=O(!1),g=O(!1);let C=0;const b=B(()=>{const{scale:a,moveX:i,moveY:n,moving:m,zooming:S,initializing:k}=o,M={transitionDuration:S||m||k?"0s":".3s"};return(a!==1||g.value)&&(M.transform=`matrix(${a}, 0, 0, ${a}, ${i}, ${n})`),M}),f=B(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:i}=e,n=T.value?i/o.imageRatio:a;return Math.max(0,(o.scale*n-a)/2)}return 0}),h=B(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:i}=e,n=T.value?i:a*o.imageRatio;return Math.max(0,(o.scale*n-i)/2)}return 0}),R=(a,i)=>{var n;if(a=Y(a,+e.minZoom,+e.maxZoom+1),a!==o.scale){const m=a/o.scale;if(o.scale=a,i){const S=ue((n=l.value)==null?void 0:n.$el),k={x:S.width*.5,y:S.height*.5},M=o.moveX-(i.x-S.left-k.x)*(m-1),ge=o.moveY-(i.y-S.top-k.y)*(m-1);o.moveX=Y(M,-f.value,f.value),o.moveY=Y(ge,-h.value,h.value)}else o.moveX=0,o.moveY=g.value?C:0;c("scale",{scale:a,index:e.active})}},P=()=>{R(1)},Z=()=>{const a=o.scale>1?1:2;R(a,a===2||g.value?{x:r.startX.value,y:r.startY.value}:void 0)};let t,w,I,s,x,y,D,Q,j=!1;const ve=a=>{const{touches:i}=a;if(t=i.length,t===2&&e.disableZoom)return;const{offsetX:n}=r;r.start(a),w=o.moveX,I=o.moveY,Q=Date.now(),j=!1,o.moving=t===1&&(o.scale!==1||g.value),o.zooming=t===2&&!n.value,o.zooming&&(s=o.scale,x=te(i))},me=a=>{const{touches:i}=a;if(r.move(a),o.moving){const{deltaX:n,deltaY:m}=r,S=n.value+w,k=m.value+I;if((e.vertical?r.isVertical()&&Math.abs(k)>h.value:r.isHorizontal()&&Math.abs(S)>f.value)&&!j){o.moving=!1;return}j=!0,F(a,!0),o.moveX=Y(S,-f.value,f.value),o.moveY=Y(k,-h.value,h.value)}if(o.zooming&&(F(a,!0),i.length===2)){const n=te(i),m=s*n/x;y=Ne(i),R(m,y)}},J=a=>{var i;const n=(i=d.value)==null?void 0:i.$el;if(!n)return;const m=n.firstElementChild,S=a.target===n,k=m==null?void 0:m.contains(a.target);!e.closeOnClickImage&&k||!e.closeOnClickOverlay&&S||c("close")},de=a=>{if(t>1)return;const i=Date.now()-Q,n=250;r.isTap.value&&(i<n?e.doubleScale?D?(clearTimeout(D),D=null,Z()):D=setTimeout(()=>{J(a),D=null},n):J(a):i>ke&&c("longPress"))},p=a=>{let i=!1;if((o.moving||o.zooming)&&(i=!0,o.moving&&w===o.moveX&&I===o.moveY&&(i=!1),!a.touches.length)){o.zooming&&(o.moveX=Y(o.moveX,-f.value,f.value),o.moveY=Y(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,w=0,I=0,s=1,o.scale<1&&P();const n=+e.maxZoom;o.scale>n&&R(n,y)}F(a,i),de(a),r.reset()},ee=()=>{const{rootWidth:a,rootHeight:i}=e,n=i/a,{imageRatio:m}=o;T.value=o.imageRatio>n&&m<ie,g.value=o.imageRatio>n&&m>=ie,g.value&&(C=(m*a-i)/2,o.moveY=C,o.initializing=!0,be(()=>{o.initializing=!1})),P()},oe=a=>{const{naturalWidth:i,naturalHeight:n}=a.target;o.imageRatio=n/i,ee()};return X(()=>e.active,P),X(()=>e.show,a=>{a||P()}),X(()=>[e.rootWidth,e.rootHeight],ee),Ce("touchmove",me,{target:B(()=>{var a;return(a=d.value)==null?void 0:a.$el})}),ce({resetScale:P}),()=>{const a={loading:()=>u(xe,{type:"spinner"},null)};return u(De,{ref:d,class:V("swipe-item"),onTouchstartPassive:ve,onTouchend:p,onTouchcancel:p},{default:()=>[v.image?u("div",{class:V("image-wrap")},[v.image({src:e.src,onLoad:oe,style:b.value})]):u(We,{ref:l,src:e.src,fit:"contain",class:V("image",{vertical:T.value}),style:b.value,onLoad:oe},a)]})}}});const[Ue,$]=K("image-preview"),Fe=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ve={show:Boolean,loop:z,images:ze(),minZoom:H(1/3),maxZoom:H(3),overlay:z,vertical:Boolean,closeable:Boolean,showIndex:z,className:ae,closeIcon:N("clear"),transition:String,beforeClose:Function,doubleScale:z,overlayClass:ae,overlayStyle:Object,swipeDuration:H(300),startPosition:H(0),showIndicators:Boolean,closeOnPopstate:z,closeOnClickImage:z,closeOnClickOverlay:z,closeIconPosition:N("top-right"),teleport:[String,Object]};var qe=G({name:Ue,props:Ve,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:v}){const o=O(),r=O(),l=re({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),d=()=>{if(o.value){const s=ue(o.value.$el);l.rootWidth=s.width,l.rootHeight=s.height,o.value.resize()}},T=s=>c("scale",s),g=s=>c("update:show",s),C=()=>{Ze(e.beforeClose,{args:[l.active],done:()=>g(!1)})},b=s=>{s!==l.active&&(l.active=s,c("change",s))},f=()=>{if(e.showIndex)return u("div",{class:$("index")},[v.index?v.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},h=()=>{if(v.cover)return u("div",{class:$("cover")},[v.cover()])},R=()=>{l.disableZoom=!0},P=()=>{l.disableZoom=!1},Z=()=>u(Be,{ref:o,lazyRender:!0,loop:e.loop,class:$("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:b,onDragEnd:P,onDragStart:R},{default:()=>[e.images.map((s,x)=>u(je,{ref:y=>{x===l.active&&(r.value=y)},src:s,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:T,onClose:C,onLongPress:()=>c("longPress",{index:x})},{image:v.image}))]}),t=()=>{if(e.closeable)return u(se,{role:"button",name:e.closeIcon,class:[$("close-icon",e.closeIconPosition),Xe],onClick:C},null)},w=()=>c("closed"),I=(s,x)=>{var y;return(y=o.value)==null?void 0:y.swipeTo(s,x)};return ce({resetScale:()=>{var s;(s=r.value)==null||s.resetScale()},swipeTo:I}),le(d),X([Oe,Te],d),X(()=>e.startPosition,s=>b(+s)),X(()=>e.show,s=>{const{images:x,startPosition:y}=e;s?(b(+y),q(()=>{d(),I(+y,{immediate:!0})})):c("close",{index:l.active,url:x[l.active]})}),()=>u(Ye,A({class:[$(),e.className],overlayClass:[$("overlay"),e.overlayClass],onClosed:w,"onUpdate:show":g},Re(e,Fe)),{default:()=>[t(),Z(),f(),h()]})}});let W;const Ke={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Ge(){({instance:W}=$e({setup(){const{state:e,toggle:c}=Le(),v=()=>{e.images=[]};return()=>u(qe,A(e,{onClosed:v,"onUpdate:show":c}),null)}}))}const pe=(e,c=0)=>{if(ne)return W||Ge(),e=Array.isArray(e)?{images:e,startPosition:c}:e,W.open(Ee({},Ke,e)),W};export{pe as a,qe as s};
